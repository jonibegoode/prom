<!DOCTYPE html>
<html>
<head>
    <title>Trials list</title>
    <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href=" {{ asset('css/webix.css') }}">
    <script src="//ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script src="{{ asset('js/webix.js') }}" type="text/javascript"></script>

</head>
<body>

Bonjour {{ app.user.username }}
<a href="{{ path('erp_homepage') }}">accueil</a>
<a href="{{ path('fos_user_security_logout') }}">logout</a>

{{ dump() }}

<hr>

<div id="test"></div>

<script type="text/javascript">
    var searchbar = {
        view: "text",
        placeholder: "Type something to filter the grid",
        on: {
            onTimedKeyPress: function () {
                var text = this.getValue().toLowerCase();
                var table = $$("dtable");
                var columns = table.config.columns;
                table.filter(function (obj) {
                    for (var i = 0; i < columns.length; i++)
                        if (obj[columns[i].id].toString().toLowerCase().indexOf(text) !== -1) return true;
                    return false;
                })
            }
        }
    };
    var griddef = {
        view: "datatable",
        id: "dtable",
        headermenu: true,
        columns: [

            {
                id: "g_project_manager",
                header: [{
                    content: "columnGroup",
                    closed: false,
                    batch: "main",
                    groupText: "main information",
                    colspan: 20,
                    width: 200
                }, "Project Manager", {content: "textFilter"}],
                editor: "text",
                width: 150,
                sort: "string"
            },
            {
                id: "g_departement",
                batch: "main",
                editor: "text",
                header: [null, "Zip Code", {content: "textFilter"}],
                width: 80,
                sort: "int"
            },
            {
                id: "g_country",
                batch: "main",
                editor: "text",
                header: [null, "Country", {content: "textFilter"}],
                width: 120,
                sort: "string"
            },
            {
                id: "g_technician",
                batch: "main",
                editor: "text",
                header: [null, "Technician", {content: "textFilter"}],
                width: 150,
                sort: "string"
            },
            {
                id: "g_cofrac_code",
                batch: "main",
                editor: "text",
                header: [null, "Cofrac", {content: "selectFilter"}],
                width: 60,
                sort: "string"
            },
            {
                id: "g_year",
                batch: "main",
                editor: "text",
                header: [null, "Year", {content: "textFilter"}],
                width: 60,
                sort: "int"
            },
            {
                id: "g_efip",
                batch: "main",
                editor: "multiselect",
                optionslist: true,
                options: [
                    {id: 1, value: "E"},
                    {id: 2, value: "F"},
                    {id: 3, value: "I"},
                    {id: 4, value: "P"}
                ],
                header: [null, "EFIP", {content: "selectFilter"}],
                width: 50,
                sort: "string"
            },
            {
                id: "g_hfieds",
                batch: "main",
                editor: "text",
                header: [null, { text:"HFIEDS", rotate:true}, {content: "selectFilter"}],
                width: 65,
                sort: "string"
            },
            {
                id: "g_crop_code",
                batch: "main",
                editor: "text",
                header: [null, "Crop Code", {content: "selectFilter"}],
                width: 60,
                sort: "string"
            },
            {
                id: "g_sponsor", value: "g_sponsor.id",
                batch: "main",
                editor: "text",
                header: [null, "Sponsor", {content: "textFilter"}],
                width: 150,
                sort: "string"
            },
            {
                id: "g_bps",
                batch: "main",
                editor: "text",
                header: [null, "BPS", {content: "selectFilter"}],
                width: 50,
                sort: "string"
            },
            {
                id: "g_protocol_number",
                batch: "main",
                editor: "text",
                header: [null, "Protocole Code", {content: "textFilter"}],
                width: 150,
                sort: "string"
            },
            {
                id: "g_trial_number",
                batch: "main",
                editor: "text",
                header: [null, "Trial Code", {content: "textFilter"}],
                width: 150,
                sort: "string"
            },
            {
                id: "g_sponsor_contact",
                batch: "main",
                editor: "text",
                header: [null, "Sponsor Contact", {content: "textFilter"}],
                width: 150,
                sort: "string"
            },
            {
                id: "g_sponsor_protocol_number",
                batch: "main",
                editor: "text",
                header: [null, "Sponsor Protocol Code", {content: "textFilter"}],
                width: 150,
                sort: "string"
            },
            {
                id: "g_sponsor_trial_number",
                batch: "main",
                editor: "text",
                header: [null, "Sponsor Trial Code", {content: "textFilter"}],
                width: 150,
                sort: "string"
            },
            {
                id: "g_declaration_number",
                batch: "main",
                editor: "text",
                header: [null, "Declaration Number", {content: "textFilter"}],
                width: 150,
                sort: "string"
            },
            {
                id: "g_theme",
                batch: "main",
                editor: "text",
                header: [null, "Theme", {content: "textFilter"}],
                width: 120,
                sort: "string"
            },
            {
                id: "g_crop",
                batch: "main",
                editor: "text",
                header: [null, "Crop", {content: "textFilter"}],
                width: 120,
                sort: "string"
            },
            {
                id: "g_pathogen",
                batch: "main",
                editor: "text",
                header: [null, "Pathogen", {content: "textFilter"}],
                width: 150,
                sort: "string"
            },

            {
                id: "p_cl_received_date",
                header: [{
                    content: "columnGroup",
                    closed: false,
                    batch: "protocol",
                    groupText: "Protocol",
                    colspan: 9,
                    width: 200
                }, "CL Received Date", {content: "dateFilter"}],
                editor: "date",
                width: 150,
                sort: "date"
            },
            {
                id: "p_cl_arm_received",
                batch: "protocol",
                editor: "checkbox",
                header: [null, "CL ARM Received", {content: "selectFilter"}],
                width: 150,
                sort: "string"
            },
            {
                id: "p_pv_arm_contract_info",
                batch: "protocol",
                editor: "checkbox",
                header: [null, "PV+ARM+Fiche contrat+fiche info", {content: "selectFilter"}],
                width: 200,
                sort: "string"
            },
            {
                id: "p_permit_derogation_cl",
                batch: "protocol",
                editor: "checkbox",
                header: [null, "Permis+DÃ©rogation CL", {content: "selectFilter"}],
                width: 150,
                sort: "string"
            },
            {
                id: "p_derogation_pv_date",
                batch: "protocol",
                editor: "date",
                header: [null, "Derogation PV Date", {content: "dateFilter"}],
                width: 150,
                sort: "date"
            },
            {
                id: "p_official_declaration_date",
                batch: "protocol",
                editor: "date",
                header: [null, "Official Declaration Date", {content: "dateFilter"}],
                width: 150,
                sort: "date"
            },
            {
                id: "p_pv_version_sent",
                batch: "protocol",
                editor: "text",
                header: [null, "PV version sent", {content: "selectFilter"}],
                width: 150,
                sort: "string"
            },
            {
                id: "p_pv_version_sent_date",
                batch: "protocol",
                editor: "date",
                header: [null, "PV version sent date", {content: "dateFilter"}],
                width: 200,
                sort: "date"
            },
            {
                id: "p_tech_sent_date",
                batch: "protocol",
                editor: "date",
                header: [null, "Techn sent date", {content: "dateFilter"}],
                width: 150,
                sort: "date"
            },

        ],

        editable: true,
        select: "cell",
        blockselect: true,
        multiselect: true,
        navigation: true,
        autoheight: true,
        autowidth: true,


        save: "rest->{{ path('api_post_t') }}",
        url: "rest->{{ path('erp_trialapi_cgetload') }}"

    };
    var excelexport = {
        view: "form",
        css: "toolbar",
        paddingY: 5,
        paddingX: 10,
        cols: [
            /*{
                view: "label",
                label: "options",
                width: 200
            },*/
            {
                view: "button",
                value: "Add row",
                width: 80,
                click: function () {
                    $$('dtable').add({
                        id: 10000,
                    });
                }
            },
            {
                view: "button",
                value: "Delete row",
                width: 80,
                click: function () {
                    var id = $$('dtable').getSelectedId();
                    if (id)
                        $$('dtable').remove(id);
                }
            },
            {
                view: "button",
                value: "Export to PDF",
                autowidth: true,
                click: function () {
                    webix.toPDF($$("dtable"), {
                        autowidth: true,
                    });
                }
            },
            {
                view: "button",
                label: "Export to Excel",
                width: 120,
                click: function () {
                    webix.toExcel($$("dtable"));
                }
            },
        ]
    };

    var coucou = webix.ready(function () {
        grida = webix.ui({
            container: 'test',
            rows: [searchbar, excelexport, griddef],

        });
    });

    $(function(){
        $.getJSON('{{ path('erp_trialapi_cgetload') }}', function(data) {
            console.log(data);
        });
    });

    var item = coucou.getItem(data)
    console.log(item)

</script>

</body>
</html>